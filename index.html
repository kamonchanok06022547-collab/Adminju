<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADMIN MONITOR - LEKWIN JUNIOR</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-blue: #1565c0;
            --pastel-blue: #e3f2fd;
            --vivid-green: #4caf50;
            --vivid-red: #e53935;
            --offline-gray: #bdc3c7;
        }

        /* SweetAlert Style */
        .swal2-popup { border-radius: 25px !important; padding: 2em !important; width: 340px !important; }
        .swal2-title { color: #444 !important; font-size: 1.5rem !important; font-weight: bold !important; }
        .swal2-confirm { border-radius: 12px !important; padding: 12px 20px !important; font-weight: bold !important; background-color: #3b82f6 !important; }
        .swal2-cancel { border-radius: 12px !important; padding: 12px 20px !important; background-color: #6c757d !important; }

        * { box-sizing: border-box; }
        html, body { margin: 0; padding: 0; min-height: 100vh; font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--pastel-blue); color: #444; }
        body { display: flex; flex-direction: column; align-items: center; padding: 15px 10px; }
        .container { width: 100%; max-width: 700px; }
        
        .header-box { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; background: white; padding: 10px 15px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); width: 100%; border: 1px solid #d1e9ff; }
        .header-box img { width: 50px; height: 50px; border-radius: 12px; border: 2px solid var(--primary-blue); object-fit: cover; }
        .header-box h2 { margin: 0; font-size: 1.1rem; color: var(--primary-blue); }

        .card { background: #fff; border-radius: 20px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #d1e9ff; }
        .card h3 { margin: 0 0 12px 0; font-size: 1rem; color: var(--primary-blue); border-bottom: 2px solid #f0f4f8; padding-bottom: 8px; }
        
        .grid-status { display: grid; grid-template-columns: repeat(auto-fill, minmax(95px, 1fr)); gap: 6px; margin-top: 5px; }
        .status-item { padding: 8px 2px; border: 1px solid #eee; border-radius: 12px; text-align: center; font-size: 0.65rem; font-weight: bold; color: #888; background: #fafafa; }
        .status-online { background-color: #e8f5e9; border-color: #4caf50; color: #2e7d32; box-shadow: 0 0 8px rgba(76,175,80,0.3); }

        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; }
        .dot-online { background-color: var(--vivid-green); box-shadow: 0 0 8px var(--vivid-green); }
        .dot-offline { background-color: var(--offline-gray); }

        .create-box { display: flex; flex-direction: column; gap: 8px; }
        .create-box input { padding: 12px; border-radius: 12px; border: 1.5px solid #eee; outline: none; }
        .create-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-new-30 { background: #ce93d8; color: white; padding: 10px; border-radius: 10px; font-weight: bold; border:none; cursor: pointer; }
        .btn-new-perm { background: #4fc3f7; color: white; padding: 10px; border-radius: 10px; font-weight: bold; border:none; cursor: pointer; }

        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        td { padding: 10px 8px; border-bottom: 1px solid #f9f9f9; vertical-align: middle; }

        button { cursor: pointer; border: none; font-weight: 600; border-radius: 8px; padding: 6px 10px; font-size: 0.7rem; }
        .btn-perm { background: #fdf2f8; color: #db2777; margin-right: 3px; }
        .btn-add { background: #f0fdf4; color: #16a34a; margin-right: 3px; }
        .btn-del { background: #fef2f2; color: #dc2626; }
        .btn-kick { background: #fffde7; color: #fbc02d; margin-right: 5px; }
        .btn-ban { background: #ffebee; color: #c62828; }
        .btn-unban { background: #e8f5e9; color: #2e7d32; }

        #loginOverlay { position: fixed; inset: 0; background: #e3f2fd; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-card { background: white; width: 85%; max-width: 320px; padding: 25px; border-radius: 25px; text-align: center; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-card">
        <img src="https://i.pinimg.com/1200x/7a/82/11/7a8211a2161799550aa868aaab6d5c84.jpg" style="width:100px; height:100px; object-fit:cover; border-radius:20px; margin-bottom:15px; border: 3px solid #1565c0;">
        <h3>Admin Login</h3>
        <input id="userPass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" style="width:100%; padding:12px; margin-bottom:12px; border-radius:12px; border:1px solid #ddd; text-align:center;">
        <button onclick="doLogin()" style="background: var(--primary-blue); color:white; width:100%; padding:12px; border-radius:12px; border:none; font-weight:bold;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‚ú®</button>
    </div>
</div>

<div id="main" class="container" style="display:none; padding-top: 20px;">
    <div class="header-box">
        <img src="https://i.pinimg.com/1200x/7a/82/11/7a8211a2161799550aa868aaab6d5c84.jpg" alt="Admin">
        <div>
            <h2>ADMIN MONITOR</h2>
            <small style="color: #888;">Real-time System Control</small>
        </div>
    </div>

    <div class="card">
        <h3>‚ú® ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
        <div class="create-box">
            <input id="newCodeInput" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏´‡∏±‡∏™...">
            <div class="create-btns">
                <button class="btn-new-30" onclick="addNewCode(false)">üìûNew 30dayüìû</button>
                <button class="btn-new-perm" onclick="addNewCode(true)">‚ôæÔ∏è ‡∏ñ‡∏≤‡∏ß‡∏£‚ôæÔ∏è</button>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>üåü üü¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h3>
        <div id="statusGrid" class="grid-status"></div>
    </div>

    <div class="card">
        <h3>üë• ‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Real-time)</h3>
        <table>
            <thead>
                <tr><th width="30"></th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th><th align="right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
            </thead>
            <tbody id="onlineListTbody"></tbody>
        </table>
    </div>

    <div class="card">
        <h3>‚ú® ‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‚ú®</h3>
        <table>
            <tbody id="newCodesTbody"></tbody>
        </table>
    </div>

    <div class="card" id="bannedCard" style="border: 1px solid #ffcdd2;">
        <h3 style="color: #c62828;">üö´ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏ö‡∏ô</h3>
        <table>
            <tbody id="bannedListTbody"></tbody>
        </table>
    </div>

    <button onclick="doLogout()" style="background:#b0bec5; color:white; width:100%; padding:12px; border-radius:12px; margin-bottom:40px; font-weight:bold; border:none;">LOGOUT</button>
</div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyC1iAT_0vKk6Uew2VJtN3_wx4JszVTTTjY",
    authDomain: "junior-nior.firebaseapp.com",
    databaseURL: "https://junior-nior-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "junior-nior",
    storageBucket: "junior-nior.firebasestorage.app",
    messagingSenderId: "225309280850",
    appId: "1:225309280850:web:49e3f857eb8a4a250a2d8b"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ADMIN_PASS = "adminwinjuniorkmcn0602";
const PERM_VAL = 32503680000000;
const STATUS_LIST = ["asdf1313", "bestwin9", "fahsai1919", "gold8888", "jueiei0606", "jujuwin0303", "julnwwin1212", "junior007", "juny0707", "juwin0202", "kaimook2020", "lekwinju0404", "lnwwinju1111", "lucky789", "money168", "niorwin0808", "popo1717", "power88", "qwer1616", "rich9999", "smile11", "star555", "winarrai1010", "winju0101", "winlek0505", "winnior0909", "winwin24", "ziber1818", "zxcv1414"];

function doLogin() { if(document.getElementById("userPass").value === ADMIN_PASS) { sessionStorage.setItem("isAdminActive", "true"); checkAuth(); } else { Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', '', 'error'); } }
function doLogout() { sessionStorage.clear(); location.reload(); }
function checkAuth() { if(sessionStorage.getItem("isAdminActive") === "true") { document.getElementById("loginOverlay").style.display = "none"; document.getElementById("main").style.display = "block"; loadData(); } }

function formatThaiDate(ts) {
    if (ts >= 3000000000000) return "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏";
    const d = new Date(ts);
    // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡∏û.‡∏®. ‡∏¢‡πà‡∏≠ (‡∏õ‡∏µ‡∏Ñ.‡∏®. + 43)
    return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getFullYear() + 43).slice(-2)}`;
}

function loadData() {
    db.ref().on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const custom = data.custom_codes || {};
        const online = data.online_users || {};
        const banned = data.banned_codes || {};
        
        // 1. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö/‡πÅ‡∏ö‡∏ô)
        const onlineTbody = document.getElementById("onlineListTbody");
        onlineTbody.innerHTML = "";
        Object.keys(online).forEach(key => {
            const isExist = custom[key] !== undefined || STATUS_LIST.includes(key);
            const isBanned = banned[key] !== undefined;
            if (isExist && !isBanned) {
                const user = online[key];
                onlineTbody.innerHTML += `<tr>
                    <td align="center"><span class="status-dot ${user.status === 'online' ? 'dot-online' : 'dot-offline'}"></span></td>
                    <td><b>${key}</b></td>
                    <td><span style="color:#666;">${user.name || '-'}</span></td>
                    <td align="right">
                        <button class="btn-kick" onclick="popKick('${key}')">üêæ ‡πÄ‡∏ï‡∏∞</button>
                        <button class="btn-ban" onclick="popBan('${key}')">ü§¨ ‡πÅ‡∏ö‡∏ô</button>
                    </td>
                </tr>`;
            } else {
                db.ref('online_users/' + key).remove();
            }
        });

        // 2. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Grid
        const grid = document.getElementById("statusGrid");
        grid.innerHTML = "";
        const allKeys = [...STATUS_LIST, ...Object.keys(custom).filter(k => !STATUS_LIST.includes(k))];
        allKeys.forEach(code => {
            const isOnline = online[code] && online[code].status === 'online';
            grid.innerHTML += `<div class="status-item ${isOnline ? 'status-online' : ''}">${code}</div>`;
        });

        // 3. ‡∏£‡∏´‡∏±‡∏™‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)
        const newTbody = document.getElementById("newCodesTbody");
        newTbody.innerHTML = "";
        Object.keys(custom).sort().forEach(code => {
            if (!STATUS_LIST.includes(code) || ["1123asdf", "kaophod11", "tommy40", "zzxx123"].includes(code)) {
                const exp = custom[code].expireAt;
                const isPerm = exp >= 3000000000000;
                let statusHTML = "";

                if (isPerm) {
                    statusHTML = "<b style='color:#db2777;'>‚ôæÔ∏è ‡∏ñ‡∏≤‡∏ß‡∏£</b>";
                } else {
                    const diff = exp - Date.now();
                    if (diff > 0) {
                        const d = Math.floor(diff / 86400000);
                        const h = Math.floor((diff % 86400000) / 3600000);
                        const m = Math.floor((diff % 3600000) / 60000);
                        statusHTML = `<span style="color:#2e7d32; font-weight:bold;">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${d} ‡∏ß‡∏±‡∏ô ${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ</span><br>
                                      <small style="color:#888;">(‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${formatThaiDate(exp)})</small>`;
                    } else {
                        statusHTML = "<span style='color:grey;'>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>";
                    }
                }

                newTbody.innerHTML += `<tr>
                    <td><b>${code}</b></td>
                    <td>${statusHTML}</td>
                    <td align="right">
                        <button class="btn-perm" onclick="popPerm('${code}', ${isPerm})">‚ôæÔ∏è ‡∏ñ‡∏≤‡∏ß‡∏£</button>
                        <button class="btn-add" onclick="popAddDays('${code}')">üåø ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        <button class="btn-del" onclick="popDelete('${code}')">üóëÔ∏è ‡∏•‡∏ö</button>
                    </td>
                </tr>`;
            }
        });

        // 4. ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ô
        const banTbody = document.getElementById("bannedListTbody");
        banTbody.innerHTML = "";
        Object.keys(banned).forEach(c => {
            banTbody.innerHTML += `<tr><td><b style="color:red;">üö´ ${c}</b></td><td align="right"><button class="btn-unban" onclick="popUnban('${c}')">üîì ‡∏õ‡∏•‡∏î</button></td></tr>`;
        });
    });
}

function addNewCode(isP) {
    const code = document.getElementById("newCodeInput").value.trim();
    if(!code) return;
    db.ref('custom_codes/'+code).set({ expireAt: isP ? PERM_VAL : Date.now()+(30*86400000) });
    document.getElementById("newCodeInput").value = "";
    Swal.fire({ icon: 'success', title: '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 800, showConfirmButton: false });
}

function popKick(c) {
    Swal.fire({ title: '‡πÄ‡∏ï‡∏∞‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ?', text: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚ú®', cancelButtonText: 'Cancel' })
    .then((r) => { if(r.isConfirmed) db.ref('online_users/'+c).remove(); });
}

function popDelete(c) {
    Swal.fire({ title: '‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ?', text: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚ú®', cancelButtonText: 'Cancel' })
    .then((r) => { if(r.isConfirmed) { 
        db.ref('custom_codes/'+c).remove(); 
        db.ref('online_users/'+c).remove(); 
        db.ref('banned_codes/'+c).remove();
        Swal.fire({ title: '‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!', icon: 'success', timer: 800, showConfirmButton: false });
    }});
}

function popBan(c) {
    Swal.fire({ title: '‡πÅ‡∏ö‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ?', text: '‡∏£‡∏´‡∏±‡∏™‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô', showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚ú®', cancelButtonText: 'Cancel' })
    .then((r) => { if(r.isConfirmed) { 
        db.ref('banned_codes/'+c).set(true); 
        db.ref('custom_codes/'+c).remove(); 
        db.ref('online_users/'+c).remove(); 
        Swal.fire({ title: '‡πÅ‡∏ö‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', icon: 'success', timer: 800, showConfirmButton: false });
    }});
}

function popAddDays(c) {
    Swal.fire({ title: '‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô üåø', input: 'number', inputValue: 30, showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚ú®' })
    .then((r) => { if(r.isConfirmed && r.value) {
        db.ref('custom_codes/'+c).once('value', s => {
            let cur = (s.val() && s.val().expireAt > Date.now()) ? s.val().expireAt : Date.now();
            db.ref('custom_codes/'+c).update({ expireAt: cur + (r.value*86400000) });
        });
    }});
}

function popPerm(c, isP) {
    Swal.fire({ title: isP ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ñ‡∏≤‡∏ß‡∏£?' : '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ñ‡∏≤‡∏ß‡∏£?', showCancelButton: true, confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚ú®' })
    .then((r) => { if(r.isConfirmed) db.ref('custom_codes/'+c).update({ expireAt: isP ? Date.now()+(30*86400000) : PERM_VAL }); });
}

function popUnban(c) {
    Swal.fire({ title: '‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ?', showCancelButton: true, confirmButtonText: '‡∏õ‡∏•‡∏î‡πÅ‡∏ö‡∏ô üîì' })
    .then((r) => { if(r.isConfirmed) { db.ref('banned_codes/'+c).remove(); db.ref('custom_codes/'+c).set({ expireAt: Date.now()+(30*86400000) }); }});
}

checkAuth();
</script>
</body>
</html>
