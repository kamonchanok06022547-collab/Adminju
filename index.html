<div class="card">
    <h3 style="color:#6a1b9a;">üîë ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô & ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</h3>
    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
        <input id="keyDays" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 30)" style="flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #ddd;">
        <button onclick="generateKey()" style="background: #6a1b9a; color: white; padding: 10px 20px;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™</button>
    </div>
    
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>‡∏£‡∏´‡∏±‡∏™ (Key)</th>
                    <th>‡∏≠‡∏≤‡∏¢‡∏∏</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                    <th>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="keyListTableBody"></tbody>
        </table>
    </div>
</div>

<script>
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏∏‡πà‡∏°
function generateKey() {
    const days = document.getElementById("keyDays").value;
    if(!days || days <= 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

    const newKey = "WIN-" + Math.random().toString(36).substr(2, 8).toUpperCase();
    
    db.ref('license_keys/' + newKey).set({
        key: newKey,
        days: parseInt(days),
        status: "unused",
        expireDate: null,
        usedBy: ""
    }).then(() => {
        alert("‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + newKey);
        document.getElementById("keyDays").value = "";
    });
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Key ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
function loadKeys() {
    db.ref('license_keys').on('value', (snapshot) => {
        const tbody = document.getElementById("keyListTableBody");
        tbody.innerHTML = "";
        const data = snapshot.val();
        if(data) {
            Object.keys(data).forEach(id => {
                const k = data[id];
                const tr = document.createElement("tr");
                
                let statusText = k.status === 'unused' ? '<span style="color:green">‡∏ß‡πà‡∏≤‡∏á</span>' : `<span style="color:blue">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${k.usedBy}</span>`;
                let expireText = k.expireDate ? new Date(k.expireDate).toLocaleDateString('th-TH') : "-";

                tr.innerHTML = `
                    <td><strong>${k.key}</strong></td>
                    <td>${k.days} ‡∏ß‡∏±‡∏ô</td>
                    <td>${statusText}</td>
                    <td>${expireText}</td>
                    <td><button onclick="deleteKey('${id}')" style="background:#ff5252; color:white;">‡∏•‡∏ö</button></td>
                `;
                tbody.appendChild(tr);
            });
        }
    });
}

function deleteKey(id) {
    if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ?")) db.ref('license_keys/' + id).remove();
}

// ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° loadKeys(); ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢
// ‡πÄ‡∏ä‡πà‡∏ô‡πÉ‡∏ô checkAuth() ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏° loadKeys(); ‡∏•‡∏á‡πÑ‡∏õ
</script>
